<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>S∆° ƒë·ªì l·ªõp h·ªçc</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f9fa;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    h1 { margin-bottom: 20px; color: #333; }
    .classroom {
      display: grid;
      grid-template-rows: repeat(4, auto);
      gap: 30px;
      max-width: 1200px;
      margin: auto;
    }
    .group {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 15px;
      justify-items: center;
    }
    .table {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      padding: 10px;
      width: 120px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .table h3 { margin: 0; font-size: 14px; color: #444; }
    .seat { display: flex; gap: 6px; }
    .seat input {
      flex: 1;
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 13px;
      text-align: center;
    }
    .btns {
      margin-top: 25px;
      display: flex;
      justify-content: center;
      gap: 15px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
      color: white;
    }
    .save-btn { background: #4caf50; }
    .save-btn:hover { background: #43a047; }
    .load-btn { background: #2196f3; }
    .load-btn:hover { background: #1976d2; }
  </style>
</head>
<body>
  <h1>S∆° ƒë·ªì l·ªõp h·ªçc</h1>
  <div class="classroom" id="classroom"></div>

  <div class="btns">
    <button class="save-btn" onclick="saveAll()">üíæ L∆∞u t·∫•t c·∫£</button>
    <button class="load-btn" onclick="loadData()">üîÑ T·∫£i l·∫°i</button>
  </div>

  <script>
    const classroom = document.getElementById("classroom");

    // T·∫°o s∆° ƒë·ªì l·ªõp
    for (let group = 1; group <= 4; group++) {
      const groupDiv = document.createElement("div");
      groupDiv.className = "group";

      for (let table = 1; table <= 6; table++) {
        const tableDiv = document.createElement("div");
        tableDiv.className = "table";

        const title = document.createElement("h3");
        title.textContent = `T·ªï ${group} - B√†n ${table}`;
        tableDiv.appendChild(title);

        const seatDiv = document.createElement("div");
        seatDiv.className = "seat";

        for (let seat = 1; seat <= 2; seat++) {
          const input = document.createElement("input");
          input.type = "text";
          input.placeholder = `HS ${seat}`;
          input.dataset.group = group;
          input.dataset.table = table;
          input.dataset.seat = seat;

          input.addEventListener("change", () => saveOne(input));
          seatDiv.appendChild(input);
        }

        tableDiv.appendChild(seatDiv);
        groupDiv.appendChild(tableDiv);
      }

      classroom.appendChild(groupDiv);
    }

    // L∆∞u 1 √¥
    function saveOne(input) {
      const payload = {
        group: input.dataset.group,
        table: input.dataset.table,
        seat: input.dataset.seat,
        name: input.value
      };

      fetch("/saveOne", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      })
      .then(res => res.json())
      .then(msg => console.log("‚úÖ L∆∞u xong:", msg))
      .catch(err => console.error("‚ùå L·ªói khi l∆∞u:", err));
    }

    // L∆∞u t·∫•t c·∫£
    function saveAll() {
      const inputs = document.querySelectorAll("input");
      const data = [];
      inputs.forEach(input => {
        data.push({
          group: input.dataset.group,
          table: input.dataset.table,
          seat: input.dataset.seat,
          name: input.value
        });
      });

      fetch("/save", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      })
      .then(res => res.json())
      .then(() => alert("‚úÖ ƒê√£ l∆∞u t·∫•t c·∫£"))
      .catch(err => alert("‚ùå L·ªói khi l∆∞u: " + err));
    }

    // Load d·ªØ li·ªáu
    function loadData() {
      fetch("/load")
        .then(res => res.json())
        .then(data => {
          const inputs = document.querySelectorAll("input");
          inputs.forEach(input => {
            const found = data.find(item =>
              item.group == input.dataset.group &&
              item.table == input.dataset.table &&
              item.seat == input.dataset.seat
            );
            if (found) input.value = found.name;
          });
        })
        .catch(err => alert("‚ùå L·ªói khi t·∫£i: " + err));
    }

    loadData();
  </script>
</body>
</html>
